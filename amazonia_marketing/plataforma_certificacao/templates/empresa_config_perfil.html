{% extends 'base.html' %}
{% load static %}

{% block title %}Configura√ß√µes da Empresa{% endblock %}

{% block content %}
<div class="container" style="max-width: 1400px; margin: 2rem auto; padding: 0 1rem;">
    
    <!-- Cabe√ßalho -->
    <div style="background: linear-gradient(135deg, #3498db 0%, #2980b9 100%); color: white; padding: 2rem; border-radius: 12px; margin-bottom: 2rem; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
        <h1 style="margin: 0 0 0.5rem 0; font-size: 2rem;">&#127970; Configura&ccedil;&otilde;es da Empresa</h1>
        <p style="margin: 0; opacity: 0.9;">Mantenha seus dados atualizados para garantir credibilidade e conformidade</p>
        
        <!-- Status de Verifica√ß√£o -->
        <div style="margin-top: 1rem; padding: 0.75rem 1rem; background: rgba(255,255,255,0.2); border-radius: 8px; display: inline-block;">
            <strong>Status de Verifica√ß√£o:</strong> 
            {% if empresa.status_verificacao == 'verificado' %}
                <span style="color: #2ecc71;">‚úì Verificado</span>
            {% elif empresa.status_verificacao == 'pendente' %}
                <span style="color: #f39c12;">‚è≥ Pendente</span>
            {% else %}
                <span style="color: #e74c3c;">‚úó Rejeitado</span>
            {% endif %}
        </div>
    </div>

    <!-- Mensagens -->
    {% if messages %}
        {% for message in messages %}
        <div class="alert alert-{{ message.tags }}" style="padding: 1rem; border-radius: 8px; margin-bottom: 1rem;">
            {{ message }}
        </div>
        {% endfor %}
    {% endif %}

    <!-- Alerta de Documenta√ß√£o -->
    {% if not empresa.documento_cnpj or not empresa.documento_contrato_social %}
    <div style="background: #fff3cd; border: 2px solid #ffc107; color: #856404; padding: 1.5rem; border-radius: 8px; margin-bottom: 2rem;">
        <strong>‚ö†Ô∏è Aten√ß√£o:</strong> Complete a documenta√ß√£o obrigat√≥ria para verifica√ß√£o da empresa.
    </div>
    {% endif %}

    <form method="post" enctype="multipart/form-data" style="background: white; padding: 2rem; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
        {% csrf_token %}

        <!-- Se√ß√£o: Informa√ß√µes do Respons√°vel -->
        <div style="margin-bottom: 2rem;">
            <h2 style="color: #2c3e50; border-bottom: 3px solid #3498db; padding-bottom: 0.5rem; margin-bottom: 1.5rem;">
                &#128100; Informa&ccedil;&otilde;es do Respons&aacute;vel
            </h2>
            
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1.5rem;">
                <div>
                    <label style="display: block; font-weight: 600; margin-bottom: 0.5rem;">Nome do Respons√°vel</label>
                    {{ form_usuario.nome }}
                </div>
                <div>
                    <label style="display: block; font-weight: 600; margin-bottom: 0.5rem;">Email</label>
                    {{ form_usuario.email }}
                </div>
                <div>
                    <label style="display: block; font-weight: 600; margin-bottom: 0.5rem;">Telefone</label>
                    {{ form_usuario.telefone }}
                </div>
            </div>
        </div>

        <!-- Se√ß√£o: Dados Jur√≠dicos (CR√çTICO) -->
        <div style="margin-bottom: 2rem; background: #f8f9fa; padding: 1.5rem; border-radius: 8px; border-left: 4px solid #e74c3c;">
            <h2 style="color: #2c3e50; padding-bottom: 0.5rem; margin-bottom: 1.5rem;">
                &#128272; Dados Jur&iacute;dicos (Obrigat&oacute;rios)
            </h2>
            
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1.5rem;">
                <div>
                    <label style="display: block; font-weight: 600; margin-bottom: 0.5rem;">CNPJ *</label>
                    {{ form_empresa.cnpj }}
                    <small style="display: block; color: #7f8c8d; margin-top: 0.25rem;">
                        Apenas n√∫meros ou formato XX.XXX.XXX/XXXX-XX
                    </small>
                    <button type="button" onclick="validarCNPJ()" style="margin-top: 0.5rem; padding: 0.5rem 1rem; background: #3498db; color: white; border: none; border-radius: 6px; cursor: pointer;">
                        &#128269; Validar CNPJ
                    </button>
                    <div id="cnpj-resultado" style="margin-top: 0.5rem;"></div>
                </div>

                <div>
                    <label style="display: block; font-weight: 600; margin-bottom: 0.5rem;">Raz√£o Social *</label>
                    {{ form_empresa.razao_social }}
                </div>

                <div>
                    <label style="display: block; font-weight: 600; margin-bottom: 0.5rem;">Nome Fantasia</label>
                    {{ form_empresa.nome_fantasia }}
                </div>

                <div>
                    <label style="display: block; font-weight: 600; margin-bottom: 0.5rem;">Inscri√ß√£o Estadual</label>
                    {{ form_empresa.inscricao_estadual }}
                </div>
            </div>
        </div>

        <!-- Se√ß√£o: Documenta√ß√£o Comprobat√≥ria -->
        <div style="margin-bottom: 2rem; background: #fff3cd; padding: 1.5rem; border-radius: 8px; border-left: 4px solid #ffc107;">
            <h2 style="color: #2c3e50; padding-bottom: 0.5rem; margin-bottom: 1.5rem;">
                &#128196; Documenta&ccedil;&atilde;o Comprobat&oacute;ria
            </h2>
            <p style="color: #856404; margin-bottom: 1rem;">
                <strong>Importante:</strong> Envie documentos v√°lidos e leg√≠veis em formato PDF.
            </p>
            
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 1.5rem;">
                <div>
                    <label style="display: block; font-weight: 600; margin-bottom: 0.5rem;">Contrato Social / Estatuto *</label>
                    {{ form_empresa.documento_contrato_social }}
                    {% if empresa.documento_contrato_social %}
                        <a href="{{ empresa.documento_contrato_social.url }}" target="_blank" style="display: block; color: #3498db; margin-top: 0.5rem;">
                            ‚úì Documento j√° enviado
                        </a>
                    {% endif %}
                </div>

                <div>
                    <label style="display: block; font-weight: 600; margin-bottom: 0.5rem;">Comprovante de CNPJ *</label>
                    {{ form_empresa.documento_cnpj }}
                    {% if empresa.documento_cnpj %}
                        <a href="{{ empresa.documento_cnpj.url }}" target="_blank" style="display: block; color: #3498db; margin-top: 0.5rem;">
                            ‚úì Documento j√° enviado
                        </a>
                    {% endif %}
                </div>

                <div>
                    <label style="display: block; font-weight: 600; margin-bottom: 0.5rem;">Alvar√° de Funcionamento</label>
                    {{ form_empresa.documento_alvara }}
                    {% if empresa.documento_alvara %}
                        <a href="{{ empresa.documento_alvara.url }}" target="_blank" style="display: block; color: #3498db; margin-top: 0.5rem;">
                            ‚úì Documento j√° enviado
                        </a>
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- Se√ß√£o: Endere√ßo Comercial -->
        <div style="margin-bottom: 2rem;">
            <h2 style="color: #2c3e50; border-bottom: 3px solid #3498db; padding-bottom: 0.5rem; margin-bottom: 1.5rem;">
                &#128205; Endere&ccedil;o Comercial
            </h2>
            
            <div style="display: grid; grid-template-columns: 2fr 1fr 1fr 1fr; gap: 1.5rem;">
                <div style="grid-column: span 2;">
                    <label style="display: block; font-weight: 600; margin-bottom: 0.5rem;">Endere√ßo</label>
                    {{ form_empresa.endereco_comercial }}
                </div>
                <div>
                    <label style="display: block; font-weight: 600; margin-bottom: 0.5rem;">Cidade</label>
                    {{ form_empresa.cidade }}
                </div>
                <div>
                    <label style="display: block; font-weight: 600; margin-bottom: 0.5rem;">Estado</label>
                    {{ form_empresa.estado }}
                </div>
                <div>
                    <label style="display: block; font-weight: 600; margin-bottom: 0.5rem;">CEP</label>
                    {{ form_empresa.cep }}
                </div>
            </div>
        </div>

        <!-- Se√ß√£o: Contato e Presen√ßa Digital -->
        <div style="margin-bottom: 2rem;">
            <h2 style="color: #2c3e50; border-bottom: 3px solid #3498db; padding-bottom: 0.5rem; margin-bottom: 1.5rem;">
                &#128222; Contato e Presen&ccedil;a Digital
            </h2>
            
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1.5rem;">
                <div>
                    <label style="display: block; font-weight: 600; margin-bottom: 0.5rem;">Telefone Comercial</label>
                    {{ form_empresa.telefone_comercial }}
                </div>
                <div>
                    <label style="display: block; font-weight: 600; margin-bottom: 0.5rem;">Site</label>
                    {{ form_empresa.site }}
                </div>
            </div>
        </div>

        <!-- Se√ß√£o: Descri√ß√£o e Logo -->
        <div style="margin-bottom: 2rem;">
            <h2 style="color: #2c3e50; border-bottom: 3px solid #3498db; padding-bottom: 0.5rem; margin-bottom: 1.5rem;">
                &#127912; Identidade da Empresa
            </h2>
            
            <div style="margin-bottom: 1.5rem;">
                <label style="display: block; font-weight: 600; margin-bottom: 0.5rem;">Descri√ß√£o da Empresa</label>
                {{ form_empresa.descricao_empresa }}
            </div>

            <div>
                <label style="display: block; font-weight: 600; margin-bottom: 0.5rem;">Logo da Empresa</label>
                {{ form_empresa.logo }}
                {% if empresa.logo %}
                    <img src="{{ empresa.logo.url }}" alt="Logo" style="display: block; margin-top: 1rem; max-width: 200px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                {% endif %}
            </div>
        </div>

        <!-- Bot√µes -->
        <div style="display: flex; gap: 1rem; justify-content: flex-end; padding-top: 1.5rem; border-top: 2px solid #ecf0f1;">
            <a href="{% url 'home_empresa' %}" style="padding: 0.75rem 2rem; border-radius: 8px; text-decoration: none; font-weight: 600; background: #95a5a6; color: white;">
                Cancelar
            </a>
            <button type="submit" style="padding: 0.75rem 2rem; border: none; border-radius: 8px; font-weight: 600; background: linear-gradient(135deg, #3498db 0%, #2980b9 100%); color: white; cursor: pointer;">
                &#128190; Salvar Altera&ccedil;&otilde;es
            </button>
        </div>
    </form>
</div>

<script>
function validarCNPJ() {
    const cnpjInput = document.querySelector('input[name="cnpj"]');
    const cnpj = cnpjInput.value;
    const resultadoDiv = document.getElementById('cnpj-resultado');
    
    if (!cnpj) {
        resultadoDiv.innerHTML = '<span style="color: #e74c3c;">Por favor, insira um CNPJ</span>';
        return;
    }
    
    resultadoDiv.innerHTML = '<span style="color: #3498db;">üîÑ Validando...</span>';
    
    fetch(`/validar-cnpj/?cnpj=${cnpj}`)
        .then(response => response.json())
        .then(data => {
            if (data.valido) {
                resultadoDiv.innerHTML = `
                    <div style="background: #d4edda; color: #155724; padding: 1rem; border-radius: 6px; margin-top: 0.5rem;">
                        <strong>‚úì CNPJ V√°lido</strong><br>
                        <strong>Raz√£o Social:</strong> ${data.razao_social}<br>
                        ${data.nome_fantasia ? `<strong>Nome Fantasia:</strong> ${data.nome_fantasia}<br>` : ''}
                        <strong>Situa√ß√£o:</strong> ${data.situacao}
                    </div>
                `;
                // Preenche campos automaticamente
                if (data.razao_social) document.querySelector('input[name="razao_social"]').value = data.razao_social;
                if (data.nome_fantasia) document.querySelector('input[name="nome_fantasia"]').value = data.nome_fantasia;
                if (data.municipio) document.querySelector('input[name="cidade"]').value = data.municipio;
                if (data.uf) document.querySelector('select[name="estado"]').value = data.uf;
                if (data.cep) document.querySelector('input[name="cep"]').value = data.cep;
            } else {
                resultadoDiv.innerHTML = `<span style="color: #e74c3c;">‚úó ${data.erro}</span>`;
            }
        })
        .catch(error => {
            resultadoDiv.innerHTML = '<span style="color: #e74c3c;">‚úó Erro ao validar CNPJ</span>';
        });
}
</script>

<style>
    .form-input {
        width: 100%;
        padding: 0.75rem;
        border: 2px solid #e0e0e0;
        border-radius: 8px;
        font-size: 1rem;
        transition: border-color 0.3s;
    }
    
    .form-input:focus {
        outline: none;
        border-color: #3498db;
        box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
    }
</style>
{% endblock %}
